{"ast":null,"code":"import _regeneratorRuntime from \"F:/HIS/his-vue/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"F:/HIS/his-vue/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.find-index.js\";\nimport \"core-js/modules/es.array.splice.js\";\nexport default {\n  data: function data() {\n    return {\n      register: this.$route.query.register,\n      result: '',\n      diseaseId: '',\n      diseaseList: [],\n      drugList: [],\n      openDialogFlag: false,\n      queryCondition: {\n        drugName: '',\n        drugCode: ''\n      },\n      drugListDialog: [],\n      drugsDialog: []\n    };\n  },\n  methods: {\n    insure: function insure() {\n      var _this = this;\n      var fd = new FormData();\n      fd.append('registerId', this.register.registerId);\n      fd.append('result', this.result);\n      fd.append('diseaseId', this.diseaseId);\n      this.$http.put('/api/register/insure', fd).then(function (res) {\n        if (res.data.status == 1) {\n          _this.$message.success('病历号【' + _this.register.registerId + '】确诊成功');\n        } else {\n          _this.$message.error('病历号【' + _this.register.registerId + '】确诊失败');\n        }\n      });\n    },\n    openDialog: function openDialog() {\n      this.queryCondition.drugCode = '';\n      this.queryCondition.drugName = '';\n      this.drugListDialog = [];\n      this.openDialogFlag = true;\n    },\n    getDrugList: function getDrugList() {\n      var _this2 = this;\n      this.$http.get('/api/drug/listAll', {\n        params: this.queryCondition\n      }).then(function (res) {\n        _this2.drugListDialog = res.data.data.drugList;\n      });\n    },\n    clear: function clear() {\n      this.queryCondition.drugCode = '';\n      this.queryCondition.drugName = '';\n      this.drugListDialog = [];\n    },\n    //多选操作\n    handleSelectionChange: function handleSelectionChange(val) {\n      this.drugsDialog = val;\n    },\n    addDrugDialog: function addDrugDialog() {\n      var _this3 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var result;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this3.$confirm('是否确认添加药品', '确认添加');\n            case 2:\n              result = _context.sent;\n              if (result == 'confirm') {\n                _this3.drugsDialog.forEach(function (drug) {\n                  var existFlag = false;\n                  _this3.drugList.forEach(function (drugItem) {\n                    if (drugItem.drugId == drug.drugId) {\n                      existFlag = true;\n                    }\n                  });\n                  if (!existFlag) {\n                    drug.registerId = _this3.register.registerId;\n                    _this3.drugList.push(drug);\n                  }\n                });\n                _this3.openDialogFlag = false;\n              }\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    },\n    deleteDrug: function deleteDrug(drugId, drugName) {\n      var _this4 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var result, index;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _this4.$confirm('是否确认删除【' + drugName + '】', '确认删除');\n            case 2:\n              result = _context2.sent;\n              if (result == 'confirm') {\n                index = _this4.drugList.findIndex(function (drug) {\n                  return drug.drugId == drugId;\n                });\n                _this4.drugList.splice(index, 1);\n              }\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }))();\n    },\n    //\n    addPrescription: function addPrescription() {\n      var _this5 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var result;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(_this5.drugList.length == 0)) {\n                _context3.next = 3;\n                break;\n              }\n              _this5.$message.error(\"至少要选择一种药品\");\n              return _context3.abrupt(\"return\");\n            case 3:\n              _context3.next = 5;\n              return _this5.$confirm('是否确认开具处方', '确认开具');\n            case 5:\n              result = _context3.sent;\n              if (result == 'confirm') {\n                _this5.$http.post('/api/prescription/add', _this5.drugList).then(function (res) {\n                  if (res.data.status == 1) {\n                    _this5.$message.success(res.data.message);\n                    _this5.$router.push('/insure');\n                  } else {\n                    _this5.$message.error(res.data.message);\n                  }\n                });\n              }\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }))();\n    }\n  },\n  mounted: function mounted() {\n    var _this6 = this;\n    this.$http.get('/api/disease/listAll').then(function (res) {\n      _this6.diseaseList = res.data.data.diseaseList;\n    });\n  }\n};","map":{"version":3,"names":["data","register","$route","query","result","diseaseId","diseaseList","drugList","openDialogFlag","queryCondition","drugName","drugCode","drugListDialog","drugsDialog","methods","insure","_this","fd","FormData","append","registerId","$http","put","then","res","status","$message","success","error","openDialog","getDrugList","_this2","get","params","clear","handleSelectionChange","val","addDrugDialog","_this3","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","$confirm","sent","forEach","drug","existFlag","drugItem","drugId","push","stop","deleteDrug","_this4","_callee2","index","_callee2$","_context2","findIndex","splice","addPrescription","_this5","_callee3","_callee3$","_context3","length","abrupt","post","message","$router","mounted","_this6"],"sources":["src/views/treat/AddPrescription.vue"],"sourcesContent":["<template>\r\n  <div>\r\n\r\n    <!-- 面包屑导航 -->\r\n    <el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n      <el-breadcrumb-item :to=\"{path: '/welcome'}\">首页</el-breadcrumb-item>\r\n      <el-breadcrumb-item>医生诊疗</el-breadcrumb-item>\r\n      <el-breadcrumb-item>确诊病历和开具处方</el-breadcrumb-item>\r\n    </el-breadcrumb>\r\n\r\n    <!-- 卡片容器 -->\r\n    <el-card>\r\n      <el-divider>患者信息</el-divider>\r\n      <el-tag>病历号：{{ register.registerId }}</el-tag>\r\n      <el-tag type=\"success\">患者姓名：{{ register.patientName }}</el-tag>\r\n      <el-tag type=\"warning\">患者性别：{{ register.patientGender }}</el-tag>\r\n\r\n      <el-divider>确诊信息</el-divider>\r\n\r\n      诊断结果\r\n      <el-input v-model=\"result\" placeholder=\"请输入诊断结果\" style=\"width:450px\"/>\r\n\r\n      确诊疾病\r\n      <el-select v-model=\"diseaseId\" style=\"width:150px;margin-right: 30px;margin-left: 10px\">\r\n\r\n        <el-option v-for=\"disease in diseaseList\" :label=\"disease.diseaseName\" :value=\"disease.diseaseId\"/>\r\n\r\n      </el-select>\r\n\r\n      <el-button type=\"primary\" @click=\"insure\">确诊病历</el-button>\r\n\r\n      <el-divider>开具处方</el-divider>\r\n\r\n      <el-button type=\"primary\" @click=\"openDialog\">添加新药品</el-button>\r\n\r\n      <el-button type=\"seccuss\" @click=\"addPrescription\" class=\"add-button\">开具处方</el-button>\r\n\r\n      <el-table :data=\"drugList\" stripe border>\r\n\r\n        <el-table-column type=\"index\" label=\"序号\" width=\"100px\" align=\"center\"/>\r\n\r\n        <el-table-column prop=\"drugName\" label=\"药品名称\"/>\r\n        <el-table-column prop=\"drugPrice\" label=\"药品单价(元)\"/>\r\n        <el-table-column prop=\"quantity\" label=\"药品数量\"/>\r\n        <el-table-column prop=\"times\" label=\"每日次数\"/>\r\n        <el-table-column prop=\"count\" label=\"每日用量\"/>\r\n\r\n        <el-table-column label=\"操作\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button type=\"danger\" size=\"mini\" @click=\"deleteDrug(scope.row.drugId,scope.row.drugName)\"></el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-card>\r\n\r\n    <!--对话框-->\r\n    <el-dialog title=\"添加新药品\" :visible.sync=\"openDialogFlag\" width=\"50%\" center>\r\n\r\n      <el-input v-model=\"queryCondition.drugName\" placeholder=\"药品名称\" style=\"width: 180px;\" clearable/>\r\n      <el-input v-model=\"queryCondition.drugCode\" placeholder=\"药品编码\" style=\"width: 180px;\" clearable/>\r\n\r\n      <el-button type=\"primary\" @click=\"getDrugList\">查询</el-button>\r\n      <el-button type=\"primary\" @click=\"clear\">清空</el-button>\r\n\r\n      <el-table :data=\"drugListDialog\" stripe border @selection-change=\"handleSelectionChange\">\r\n\r\n        <el-table-column type=\"selection\"/>\r\n\r\n        <el-table-column label=\"expand\">\r\n          <template slot-scope=\"scope\">\r\n            <el-input v-model=\"scope.row.quantity\" placeholder=\"药品数量\" style=\"width: 150px;\" class=\"drug-usage\"/>\r\n            <el-input v-model=\"scope.row.times\" placeholder=\"每日次数\" style=\"width: 150px;\" class=\"drug-usage\"/>\r\n            <el-input v-model=\"scope.row.count\" placeholder=\"每日用量\" style=\"width: 150px;\" class=\"drug-usage\"/>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column prop=\"drugName\" label=\"药品名称\"/>\r\n        <el-table-column prop=\"drugCode\" label=\"药品编码\"/>\r\n        <el-table-column prop=\"drugPrice\" label=\"药品单价(元)\"/>\r\n\r\n      </el-table>\r\n      <!--底部区域-->\r\n      <div slot=\"footer\">\r\n\r\n        <el-button @click=\"openDialogFlag=false\">取消</el-button>\r\n\r\n        <el-button type=\"primary\" @click=\"addDrugDialog\">确定</el-button>\r\n\r\n      </div>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\r\n  data() {\r\n\r\n    return {\r\n\r\n      register: this.$route.query.register,\r\n\r\n      result: '',\r\n\r\n      diseaseId: '',\r\n\r\n      diseaseList: [],\r\n\r\n      drugList: [],\r\n\r\n      openDialogFlag: false,\r\n\r\n      queryCondition: {\r\n        drugName: '',\r\n        drugCode: '',\r\n      },\r\n\r\n      drugListDialog: [],\r\n\r\n      drugsDialog: [],\r\n\r\n\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    insure() {\r\n      let fd = new FormData();\r\n\r\n      fd.append('registerId', this.register.registerId);\r\n      fd.append('result', this.result);\r\n      fd.append('diseaseId', this.diseaseId);\r\n\r\n      this.$http.put('/api/register/insure', fd).then(\r\n          res => {\r\n\r\n            if (res.data.status == 1) {\r\n\r\n              this.$message.success('病历号【' + this.register.registerId + '】确诊成功');\r\n\r\n            } else {\r\n\r\n              this.$message.error('病历号【' + this.register.registerId + '】确诊失败');\r\n\r\n            }\r\n          }\r\n      )\r\n    },\r\n\r\n    openDialog() {\r\n      this.queryCondition.drugCode = ''\r\n      this.queryCondition.drugName = ''\r\n\r\n      this.drugListDialog = []\r\n      this.openDialogFlag = true\r\n    },\r\n\r\n    getDrugList() {\r\n      this.$http.get('/api/drug/listAll', {params: this.queryCondition}).then(\r\n          res => {\r\n            this.drugListDialog = res.data.data.drugList\r\n\r\n          }\r\n      )\r\n    },\r\n\r\n    clear() {\r\n      this.queryCondition.drugCode = ''\r\n      this.queryCondition.drugName = ''\r\n\r\n      this.drugListDialog = []\r\n    },\r\n\r\n\r\n    //多选操作\r\n    handleSelectionChange(val) {\r\n\r\n      this.drugsDialog = val;\r\n    },\r\n\r\n\r\n    async addDrugDialog() {\r\n\r\n      const result = await this.$confirm('是否确认添加药品', '确认添加')\r\n      if (result == 'confirm') {\r\n\r\n        this.drugsDialog.forEach(drug => {\r\n          let existFlag = false;\r\n          this.drugList.forEach(drugItem => {\r\n            if (drugItem.drugId == drug.drugId) {\r\n              existFlag = true\r\n            }\r\n          })\r\n          if (!existFlag) {\r\n            drug.registerId = this.register.registerId\r\n            this.drugList.push(drug)\r\n          }\r\n\r\n        })\r\n\r\n        this.openDialogFlag = false\r\n\r\n      }\r\n    },\r\n\r\n\r\n    async deleteDrug(drugId, drugName) {\r\n\r\n      const result = await this.$confirm('是否确认删除【' + drugName + '】', '确认删除')\r\n\r\n      if (result == 'confirm') {\r\n\r\n        const index = this.drugList.findIndex(drug => {\r\n          return drug.drugId == drugId\r\n        })\r\n        this.drugList.splice(index, 1)\r\n\r\n      }\r\n    },\r\n\r\n    //\r\n    async addPrescription() {\r\n\r\n      if (this.drugList.length == 0) {\r\n\r\n        this.$message.error(\"至少要选择一种药品\")\r\n        return\r\n      }\r\n\r\n      const result = await this.$confirm('是否确认开具处方', '确认开具')\r\n\r\n      if (result == 'confirm') {\r\n\r\n        this.$http.post('/api/prescription/add', this.drugList).then(\r\n            res => {\r\n\r\n              if (res.data.status == 1) {\r\n\r\n                this.$message.success(res.data.message)\r\n\r\n                this.$router.push('/insure')\r\n\r\n              } else {\r\n\r\n                this.$message.error(res.data.message)\r\n\r\n              }\r\n            }\r\n        )\r\n      }\r\n    }\r\n  },\r\n\r\n\r\n  mounted() {\r\n    this.$http.get('/api/disease/listAll').then(\r\n        res => {\r\n          this.diseaseList = res.data.data.diseaseList\r\n        }\r\n    )\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-tag {\r\n  margin: 10px;\r\n}\r\n\r\n.add-button {\r\n  position: absolute;\r\n  right: 84px;\r\n}\r\n\r\n.drug-usage {\r\n  margin-left: 22px;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}