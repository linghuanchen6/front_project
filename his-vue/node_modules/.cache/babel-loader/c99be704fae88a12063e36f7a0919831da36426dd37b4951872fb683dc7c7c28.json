{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  data() {\n    return {\n      register: this.$route.query.register,\n      result: '',\n      diseaseId: '',\n      diseaseList: [],\n      drugList: [],\n      openDialogFlag: false,\n      queryCondition: {\n        drugName: '',\n        drugCode: ''\n      },\n      drugListDialog: [],\n      drugsDialog: []\n    };\n  },\n  methods: {\n    insure() {\n      let fd = new FormData();\n      fd.append('registerId', this.register.registerId);\n      fd.append('result', this.result);\n      fd.append('diseaseId', this.diseaseId);\n      this.$http.put('/api/register/insure', fd).then(res => {\n        if (res.data.status == 1) {\n          this.$message.success('病历号【' + this.register.registerId + '】确诊成功');\n        } else {\n          this.$message.error('病历号【' + this.register.registerId + '】确诊失败');\n        }\n      });\n    },\n    openDialog() {\n      this.queryCondition.drugCode = '';\n      this.queryCondition.drugName = '';\n      this.drugListDialog = [];\n      this.openDialogFlag = true;\n    },\n    getDrugList() {\n      this.$http.get('/api/drug/listAll', {\n        params: this.queryCondition\n      }).then(res => {\n        this.drugListDialog = res.data.data.drugList;\n      });\n    },\n    clear() {\n      this.queryCondition.drugCode = '';\n      this.queryCondition.drugName = '';\n      this.drugListDialog = [];\n    },\n    //多选操作\n    handleSelectionChange(val) {\n      this.drugsDialog = val;\n    },\n    async addDrugDialog() {\n      const result = await this.$confirm('是否确认添加药品', '确认添加');\n      if (result == 'confirm') {\n        this.drugsDialog.forEach(drug => {\n          let existFlag = false;\n          this.drugList.forEach(drugItem => {\n            if (drugItem.drugId == drug.drugId) {\n              existFlag = true;\n            }\n          });\n          if (!existFlag) {\n            drug.registerId = this.register.registerId;\n            this.drugList.push(drug);\n          }\n        });\n        this.openDialogFlag = false;\n      }\n    },\n    async deleteDrug(drugId, drugName) {\n      const result = await this.$confirm('是否确认删除【' + drugName + '】', '确认删除');\n      if (result == 'confirm') {\n        const index = this.drugList.findIndex(drug => {\n          return drug.drugId == drugId;\n        });\n        this.drugList.splice(index, 1);\n      }\n    },\n    //\n    async addPrescription() {\n      if (this.drugList.length == 0) {\n        this.$message.error(\"至少要选择一种药品\");\n        return;\n      }\n      const result = await this.$confirm('是否确认开具处方', '确认开具');\n      if (result == 'confirm') {\n        this.$http.post('/api/prescription/add', this.drugList).then(res => {\n          if (res.data.status == 1) {\n            this.$message.success(res.data.message);\n            this.$router.push('/insure');\n          } else {\n            this.$message.error(res.data.message);\n          }\n        });\n      }\n    }\n  },\n  mounted() {\n    this.$http.get('/api/disease/listAll').then(res => {\n      this.diseaseList = res.data.data.diseaseList;\n    });\n  }\n};","map":{"version":3,"names":["data","register","$route","query","result","diseaseId","diseaseList","drugList","openDialogFlag","queryCondition","drugName","drugCode","drugListDialog","drugsDialog","methods","insure","fd","FormData","append","registerId","$http","put","then","res","status","$message","success","error","openDialog","getDrugList","get","params","clear","handleSelectionChange","val","addDrugDialog","$confirm","forEach","drug","existFlag","drugItem","drugId","push","deleteDrug","index","findIndex","splice","addPrescription","length","post","message","$router","mounted"],"sources":["src/views/treat/AddPrescription.vue"],"sourcesContent":["<template>\r\n  <div>\r\n\r\n    <!-- 面包屑导航 -->\r\n    <el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n      <el-breadcrumb-item :to=\"{path: '/welcome'}\">首页</el-breadcrumb-item>\r\n      <el-breadcrumb-item>医生诊疗</el-breadcrumb-item>\r\n      <el-breadcrumb-item>确诊病历和开具处方</el-breadcrumb-item>\r\n    </el-breadcrumb>\r\n\r\n    <!-- 卡片容器 -->\r\n    <el-card>\r\n      <el-divider>患者信息</el-divider>\r\n      <el-tag>病历号：{{ register.registerId }}</el-tag>\r\n      <el-tag type=\"success\">患者姓名：{{ register.patientName }}</el-tag>\r\n      <el-tag type=\"warning\">患者性别：{{ register.patientGender }}</el-tag>\r\n\r\n      <el-divider>确诊信息</el-divider>\r\n\r\n      诊断结果\r\n      <el-input v-model=\"result\" placeholder=\"请输入诊断结果\" style=\"width:450px\"/>\r\n\r\n      确诊疾病\r\n      <el-select v-model=\"diseaseId\" style=\"width:150px;margin-right: 30px;margin-left: 10px\">\r\n\r\n        <el-option v-for=\"disease in diseaseList\" :label=\"disease.diseaseName\" :value=\"disease.diseaseId\"/>\r\n\r\n      </el-select>\r\n\r\n      <el-button type=\"primary\" @click=\"insure\">确诊病历</el-button>\r\n\r\n      <el-divider>开具处方</el-divider>\r\n\r\n      <el-button type=\"primary\" @click=\"openDialog\">添加新药品</el-button>\r\n\r\n      <el-button type=\"seccuss\" @click=\"addPrescription\" class=\"add-button\">开具处方</el-button>\r\n\r\n      <el-table :data=\"drugList\" stripe border>\r\n\r\n        <el-table-column type=\"index\" label=\"序号\" width=\"100px\" align=\"center\"/>\r\n\r\n        <el-table-column prop=\"drugName\" label=\"药品名称\"/>\r\n        <el-table-column prop=\"drugPrice\" label=\"药品单价(元)\"/>\r\n        <el-table-column prop=\"quantity\" label=\"药品数量\"/>\r\n        <el-table-column prop=\"times\" label=\"每日次数\"/>\r\n        <el-table-column prop=\"count\" label=\"每日用量\"/>\r\n\r\n        <el-table-column label=\"操作\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button type=\"danger\" size=\"mini\" @click=\"deleteDrug(scope.row.drugId,scope.row.drugName)\"></el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-card>\r\n\r\n    <!--对话框-->\r\n    <el-dialog title=\"添加新药品\" :visible.sync=\"openDialogFlag\" width=\"50%\" center>\r\n\r\n      <el-input v-model=\"queryCondition.drugName\" placeholder=\"药品名称\" style=\"width: 180px;\" clearable/>\r\n      <el-input v-model=\"queryCondition.drugCode\" placeholder=\"药品编码\" style=\"width: 180px;\" clearable/>\r\n\r\n      <el-button type=\"primary\" @click=\"getDrugList\">查询</el-button>\r\n      <el-button type=\"primary\" @click=\"clear\">清空</el-button>\r\n\r\n      <el-table :data=\"drugListDialog\" stripe border @selection-change=\"handleSelectionChange\">\r\n\r\n        <el-table-column type=\"selection\"/>\r\n\r\n        <el-table-column label=\"expand\">\r\n          <template slot-scope=\"scope\">\r\n            <el-input v-model=\"scope.row.quantity\" placeholder=\"药品数量\" style=\"width: 150px;\" class=\"drug-usage\"/>\r\n            <el-input v-model=\"scope.row.times\" placeholder=\"每日次数\" style=\"width: 150px;\" class=\"drug-usage\"/>\r\n            <el-input v-model=\"scope.row.count\" placeholder=\"每日用量\" style=\"width: 150px;\" class=\"drug-usage\"/>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column prop=\"drugName\" label=\"药品名称\"/>\r\n        <el-table-column prop=\"drugCode\" label=\"药品编码\"/>\r\n        <el-table-column prop=\"drugPrice\" label=\"药品单价(元)\"/>\r\n\r\n      </el-table>\r\n      <!--底部区域-->\r\n      <div slot=\"footer\">\r\n\r\n        <el-button @click=\"openDialogFlag=false\">取消</el-button>\r\n\r\n        <el-button type=\"primary\" @click=\"addDrugDialog\">确定</el-button>\r\n\r\n      </div>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\r\n  data() {\r\n\r\n    return {\r\n\r\n      register: this.$route.query.register,\r\n\r\n      result: '',\r\n\r\n      diseaseId: '',\r\n\r\n      diseaseList: [],\r\n\r\n      drugList: [],\r\n\r\n      openDialogFlag: false,\r\n\r\n      queryCondition: {\r\n        drugName: '',\r\n        drugCode: '',\r\n      },\r\n\r\n      drugListDialog: [],\r\n\r\n      drugsDialog: [],\r\n\r\n\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    insure() {\r\n      let fd = new FormData();\r\n\r\n      fd.append('registerId', this.register.registerId);\r\n      fd.append('result', this.result);\r\n      fd.append('diseaseId', this.diseaseId);\r\n\r\n      this.$http.put('/api/register/insure', fd).then(\r\n          res => {\r\n\r\n            if (res.data.status == 1) {\r\n\r\n              this.$message.success('病历号【' + this.register.registerId + '】确诊成功');\r\n\r\n            } else {\r\n\r\n              this.$message.error('病历号【' + this.register.registerId + '】确诊失败');\r\n\r\n            }\r\n          }\r\n      )\r\n    },\r\n\r\n    openDialog() {\r\n      this.queryCondition.drugCode = ''\r\n      this.queryCondition.drugName = ''\r\n\r\n      this.drugListDialog = []\r\n      this.openDialogFlag = true\r\n    },\r\n\r\n    getDrugList() {\r\n      this.$http.get('/api/drug/listAll', {params: this.queryCondition}).then(\r\n          res => {\r\n            this.drugListDialog = res.data.data.drugList\r\n\r\n          }\r\n      )\r\n    },\r\n\r\n    clear() {\r\n      this.queryCondition.drugCode = ''\r\n      this.queryCondition.drugName = ''\r\n\r\n      this.drugListDialog = []\r\n    },\r\n\r\n\r\n    //多选操作\r\n    handleSelectionChange(val) {\r\n\r\n      this.drugsDialog = val;\r\n    },\r\n\r\n\r\n    async addDrugDialog() {\r\n\r\n      const result = await this.$confirm('是否确认添加药品', '确认添加')\r\n      if (result == 'confirm') {\r\n\r\n        this.drugsDialog.forEach(drug => {\r\n          let existFlag = false;\r\n          this.drugList.forEach(drugItem => {\r\n            if (drugItem.drugId == drug.drugId) {\r\n              existFlag = true\r\n            }\r\n          })\r\n          if (!existFlag) {\r\n            drug.registerId = this.register.registerId\r\n            this.drugList.push(drug)\r\n          }\r\n\r\n        })\r\n\r\n        this.openDialogFlag = false\r\n\r\n      }\r\n    },\r\n\r\n\r\n    async deleteDrug(drugId, drugName) {\r\n\r\n      const result = await this.$confirm('是否确认删除【' + drugName + '】', '确认删除')\r\n\r\n      if (result == 'confirm') {\r\n\r\n        const index = this.drugList.findIndex(drug => {\r\n          return drug.drugId == drugId\r\n        })\r\n        this.drugList.splice(index, 1)\r\n\r\n      }\r\n    },\r\n\r\n    //\r\n    async addPrescription() {\r\n\r\n      if (this.drugList.length == 0) {\r\n\r\n        this.$message.error(\"至少要选择一种药品\")\r\n        return\r\n      }\r\n\r\n      const result = await this.$confirm('是否确认开具处方', '确认开具')\r\n\r\n      if (result == 'confirm') {\r\n\r\n        this.$http.post('/api/prescription/add', this.drugList).then(\r\n            res => {\r\n\r\n              if (res.data.status == 1) {\r\n\r\n                this.$message.success(res.data.message)\r\n\r\n                this.$router.push('/insure')\r\n\r\n              } else {\r\n\r\n                this.$message.error(res.data.message)\r\n\r\n              }\r\n            }\r\n        )\r\n      }\r\n    }\r\n  },\r\n\r\n\r\n  mounted() {\r\n    this.$http.get('/api/disease/listAll').then(\r\n        res => {\r\n          this.diseaseList = res.data.data.diseaseList\r\n        }\r\n    )\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-tag {\r\n  margin: 10px;\r\n}\r\n\r\n.add-button {\r\n  position: absolute;\r\n  right: 84px;\r\n}\r\n\r\n.drug-usage {\r\n  margin-left: 22px;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}